
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>Spining Wheel prize</title>
        <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=yes" />
        <!-- <meta name="viewport" content="width=device-width, initial-scale=1.0"> -->
        <link rel="stylesheet" href="main.css" type="text/css" />
        <!-- Latest compiled and minified CSS -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">

        <!-- jQuery library -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <!-- <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular.min.js"></script> -->
        <!-- Latest compiled JavaScript -->
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
        <!-- <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular.min.js"></script> -->
        <!-- <script src="app/assets/js/app.js"></script> -->


        <style type="text/css">
            /*header{
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                z-index: 1;
                height: 51px;
            }*/
            header .container-fluid{
                box-shadow: 0px 7px 10px grey;
            }
            .testClass{
                    /*transition: all 0.9s ease-out 0s;*/
                    height: 70px;
            }
            section {
                    background: wheat;
                    margin-top: 70px;
                    height: 700px;
            }
            
        </style>
    </head>
    <body ng-controller="myCtrl">
        <header>
            <nav class="navbar navbar-inverse navbar-fixed-top">
              <div id="scrolltop" class="container-fluid testClass">
                <!-- Brand and toggle get grouped for better mobile display -->
                <div class="navbar-header">
                  <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false" >
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                  </button>
                  <a class="navbar-brand" href="#">
                    <img src="app/assets/images/rsz_logo2x.png" height="75" width="200" style="margin-top: -21px;"></a>
                </div>

                <!-- Collect the nav links, forms, and other content for toggling -->
                <div class="collapse navbar-collapse navbar-inverse" id="bs-example-navbar-collapse-1">
                  <ul class="nav navbar-nav">
                    <!-- <li class="active"><a href="#">Link <span class="sr-only">(current)</span></a></li> -->
                    <li><a href="https://www.referyogi.com">ReferYogi</a></li>
                    <li class="dropdown">
                      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Dropdown <span class="caret"></span></a>
                      <ul class="dropdown-menu">
                        <li><a href="#">Action</a></li>
                        <li><a href="#">Another action</a></li>
                        <li><a href="#">Something else here</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#">Separated link</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#">One more separated link</a></li>
                      </ul>
                    </li>
                  </ul>
                  <!-- <form class="navbar-form navbar-left">
                    <div class="form-group">
                      <input type="text" class="form-control" placeholder="Search">
                    </div>
                    <button type="submit" class="btn btn-default">Submit</button>
                  </form> -->
                  <ul class="nav navbar-nav navbar-right">
                    <!-- <li><a href="#">Link</a></li> -->
                    <li class="dropdown">
                      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Profile <span class="caret"></span></a>
                      <ul class="dropdown-menu">
                        <li><a href="#">Login</a></li>
                        <li><a href="#">Logout</a></li>
                        <li><a href="#">Dashboard</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#">Separated link</a></li>
                      </ul>
                    </li>
                  </ul>
                </div><!-- /.navbar-collapse -->
              </div><!-- /.container-fluid -->
            </nav>
        </header>
<section>
        <div class="container-fluid ownValue">
            <div align="center">
                <div class="row">
                    <div class="col-md-12">
                        <h2> Welcome To ReferYogi</h2>
                    </div>
                    <div class="col-md-12 hidden-md hidden-lg hidden-sm">
                        <div class="col-md-12" style="height:40px;">
                            <img src="down_arrow.png" height="48" width="38" style="margin-left: -13px;">
                        </div>
                    </div>
                    <div class="col-md-6 for-mobile">
                        <div width="438" height="582" class="the_wheel" align="center" valign="center">
                            <canvas id="canvas" width="434" height="434">
                                <p style="{color: white}" align="center">Sorry, your browser doesn't support canvas. Please try another.</p>
                            </canvas>
                        </div>
                    </div>
                    <div class="col-md-6" style="margin-top: 100px;">
                        <form onsubmit="return startfun()">
                            <div class="form-group" style="width: 50%;">
                              <label for="usr">Enter Your Bill No:</label>
                              <input type="text" class="form-control" id="usr1" placeholder="Enter your bill number" required />
                            </div>
                            <div class="form-group" style="width: 50%;">
                              <label for="usr">Enter Your Email Id:</label>
                              <input type="email" class="form-control" id="usr2" placeholder="example@example.com" required />
                            </div>
                            <div class="form-group" style="width: 50%;">
                              <label for="usr">Enter Your Mobile No:</label>
                              <input type="number" class="form-control" id="usr3" placeholder="0123456789" required />
                            </div>
                            <div class="form-group" style="width: 50%;">
                              <button id="submit-button" class="btn btn-success btn-lg" type="submit">Submit</button>
                            </div>
                        </form>
                    </div>
                </div><!-- row div-->
                <div id="overlay">
                    <div class="pop-outer">
                        <div class="pop-inner">
                            <button type="button" style="float: right;" onclick="off()" >X</button>
                            <h1 class="text-center">Congratulation!!!!</h1>
                            <h2 id="inside-popup"></h2>
                        </div>
                    </div>
                </div> 
            </div><!-- align center div-->
        </div><!-- container div-->
    </section>    
        <script type="text/javascript" src="Winwheel.min.js"></script>
        <script src="http://cdnjs.cloudflare.com/ajax/libs/gsap/latest/TweenMax.min.js"></script>
        <script>
            // Create new wheel object specifying the parameters at creation time.
            // debugger
            var theWheel = new Winwheel({
                'numSegments'       : 8,         // Specify number of segments.
                'outerRadius'       : 150,       // Set outer radius so wheel fits inside the background.
                'drawMode'          : 'image',   // drawMode must be set to image.
                'drawText'          : true,      // Need to set this true if want code-drawn text on image wheels.
                'textFontSize'      : 10,        // Set text options as desired.
                'textOrientation'   : 'curved',
                'textDirection'     : 'reversed',
                'textAlignment'     : 'outer',
                'textMargin'        : 5,
                'textFontFamily'    : 'monospace',
                'textStrokeStyle'   : 'black',
                'textLineWidth'     : 2,
                'textFillStyle'     : 'white',
                'segments'     :                // Define segments.
                [
                   {'text' : 'Free Samosa'},
                   {'text' : 'Free Wrapper'},
                   {'text' : 'Free Cake'},
                   {'text' : 'Free Coffee'},
                   {'text' : 'Free Biscuit'},
                   {'text' : 'Free Tea'},
                   {'text' : 'Free Bun'},
                   {'text' : 'Free Cream Cake'}
                ],
                'animation' :                   // Specify the animation to use.
                {
                    'type'     : 'spinToStop',
                    'duration' : 5,     // Duration in seconds.
                    'spins'    : 8,     // Number of complete spins.
                    'callbackFinished' : alertPrize,
                    'callbackSound'    : playSound,
                    'soundTrigger'     : 'pin'
                },
                'pins' :
                {
                    'number' : 8   // Number of pins. They space evenly around the wheel.
                }
            });


            // -----------------------------------------------------------------
            // This function is called when the segment under the prize pointer changes
            // we can play a small tick sound here like you would expect on real prizewheels.
            // -----------------------------------------------------------------
            var audio = new Audio('tick.mp3');  // Create audio object and load tick.mp3 file.
            // debugger
            function playSound()
            {
                // Stop and rewind the sound if it already happens to be playing.
                audio.pause();
                audio.currentTime = 0;

                // Play the sound.
                audio.play();
            }
            // Create new image object in memory.
            var loadedImg = new Image();

            // Create callback to execute once the image has finished loading.
            loadedImg.onload = function()
            {
                theWheel.wheelImage = loadedImg;    // Make wheelImage equal the loaded image object.
                theWheel.draw();                    // Also call draw function to render the wheel.
            }

            // Set the image source, once complete this will trigger the onLoad callback (above).
            loadedImg.src = "02.png";
            // -------------------------------------------------------
            // Called when the spin animation has finished by the callback feature of the wheel because I specified callback in the parameters
            // note the indicated segment is passed in as a parmeter as 99% of the time you will want to know this to inform the user of their prize.
            // -------------------------------------------------------
            function alertPrize(indicatedSegment)
            {
                // debugger
                // Do basic alert of the segment text.
                // You would probably want to do something more interesting with this information.
                $(document).ready(function(){
                    var alertValue = `You have won ${indicatedSegment.text}.`;
                    $(".pop-outer").fadeIn("slow");
                    $("#inside-popup").text(alertValue);
                })
                // alert("You have won " + indicatedSegment.text);
            }
// debugger
            // =======================================================================================================================
            // Code below for the power controls etc which is entirely optional. You can spin the wheel simply by
            // calling theWheel.startAnimation();
            // =======================================================================================================================
            var wheelPower    = 0;
            var wheelSpinning = false;

            // -------------------------------------------------------
            // Function to handle the onClick on the power buttons.
            // -------------------------------------------------------

            // -------------------------------------------------------
            // Click handler for spin button.
            // -------------------------------------------------------
            function startSpin()
            {
                // Ensure that spinning can't be clicked again while already running.
                if (wheelSpinning == false)
                {
                    // debugger
                    // Based on the power level selected adjust the number of spins for the wheel, the more times is has
                    // to rotate with the duration of the animation the quicker the wheel spins.
                    if (wheelPower == 1)
                    {
                        theWheel.animation.spins = 3;
                    }
                    else if (wheelPower == 2)
                    {
                        theWheel.animation.spins = 8;
                    }
                    else if (wheelPower == 3)
                    {
                        theWheel.animation.spins = 15;
                    }
                    // var stopAt = (91 + Math.floor((Math.random() * 43))) // prize 3
                    // var stopAt = (1000 + Math.floor((Math.random() * 50)))  // prize 7 or 8
                    // var stopAt = (900 + Math.floor((Math.random() * 50)))  // prize 5
                    // var stopAt = (800 + Math.floor((Math.random() * 50)))  // prize 3
                    // var stopAt = (750 + Math.floor((Math.random() * 60)))  // prize 2
                    // var stopAt = (500 + Math.floor((Math.random() * 43)))  // prize 4
                    // var stopAt = (200 + Math.floor((Math.random() * 43)))  // prize 4






                    // theWheel.animation.stopAngle = stopAt;
                    // Disable the spin button so can't click again while wheel is spinning.
                    // document.getElementById('spin_button').src       = "spin_off.png";
                    // document.getElementById('spin_button').className = "";

                    // Begin the spin animation by calling startAnimation on the wheel object.
                    theWheel.startAnimation();

                    // Set to true so that power can't be changed and spin button re-enabled during
                    // the current animation. The user will have to reset before spinning again.
                    wheelSpinning = true;
                }
            }

            // -------------------------------------------------------
            // Function for reset button.
            // -------------------------------------------------------
            // function resetWheel()
            // {debugger
            //     theWheel.stopAnimation(false);  // Stop the animation, false as param so does not call callback function.
            //     theWheel.rotationAngle = 0;     // Re-set the wheel angle to 0 degrees.
            //     theWheel.draw();                // Call draw to render changes to the wheel.

            //     document.getElementById('pw1').className = "";  // Remove all colours from the power level indicators.
            //     document.getElementById('pw2').className = "";
            //     document.getElementById('pw3').className = "";

            //     wheelSpinning = false;          // Reset to false to power buttons and spin can be clicked again.
            // }
            $(document).ready(function(){
                $(window).scroll(function(){
                    // debugger
                    var some = $(window).scrollTop();
                    if (some > 10) {
                        $("#scrolltop").removeClass("testClass");
                    }
                    else {
                        $("#scrolltop").addClass("testClass");
                    }
                    
                });
                // going to give effects to input fields
                // $("input").on('focus',function(){
                //     $(this).animate({
                //         left: '250px',
                //         opacity: '1',
                //         height: '40px',
                //         width: '400px'
                //     });
                // });
                // $("input").on('blur', function(){
                //     $(this).animate({
                //         left: '1px',
                //         height: '35px',
                //         width: '250px'
                //     });
                // });
            })
            function off(){
                $(".pop-outer").fadeOut("slow");
                $("#submit-button").removeAttr("disabled","true");
                document.getElementById('usr1').value = "";
                document.getElementById('usr2').value = "";
                document.getElementById('usr3').value = "";
                window.location.reload();
                window.open("https://www.referyogi.com","_blank");
            };
            function startfun(){
                // debugger
                $.ajax({
                        url: 'https://stagingapi.spini.co/spinning_wheels',
                        dataType: 'json',
                        type: 'post',
                        contentType: 'application/json',
                        // data: JSON.stringify( { "first-name": $('#first-name').val(), "last-name": $('#last-name').val() } ),
                        data: JSON.stringify( {"spinning_wheel": {
                         "email":$("#usr2").val(),"mobile":$("#usr3").val(),"bill":$("#usr1").val().toUpperCase()}}),
                        processData: false,
                        success: function( data, textStatus, jQxhr ){
                            // debugger
                            if(textStatus === "success"){
                                wheelPower = 3;
                                startSpin();
                                $("#submit-button").attr("disabled","true");
                                  var scroll = $("html, body");
                                  scroll.stop().animate({scrollTop:0}, 500, 'swing', function() {
                                  });
                            }
                        },
                        error: function( jqXhr, textStatus, errorThrown ){
                            // debugger
                            alert("Bill " + jqXhr.responseJSON.bill[0]+ " .");
                           window.location.reload();
                        }
                    });
                  return false;
                    // wheelPower = 3;
                    // startSpin();
                    // $("#submit-button").attr("disabled","true");
                    //    return false;
                    // Light up the spin button by changing it's source image and adding a clickable class to it.
                    // document.getElementById('spin_button').src = "spin_on.png";
                    // document.getElementById('spin_button').className = "clickable";
                    
            }
        </script>
    </body>
</html>
